<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<div class="layout" [class.light]="temaClaro">

  <nav class="navbar-top d-flex align-items-center px-3">
    <div class="d-flex align-items-center gap-3">
      <button class="btn btn-outline-light d-md-none border-0 px-2" (click)="alternarSidebar()"
        aria-controls="sidebar-menu" [attr.aria-expanded]="sidebarAberta" aria-label="Abrir Menu Lateral">
        <i class="bi bi-list fs-4" aria-hidden="true"></i>
      </button>

      <h4 class="m-0 fs-5 fs-md-4">Gerenciador de Tarefas</h4>
    </div>

    <div class="ms-auto d-flex align-items-center gap-2">
      <ng-container *ngIf="!usuarioLogado; else logado">
        <button class="btn btn-outline-light btn-sm" (click)="mudarAba('login')">Login</button>
        <button class="btn btn-outline-light btn-sm" (click)="mudarAba('cadastro')">Cadastro</button>
      </ng-container>
      <ng-template #logado>
        <div class="d-flex align-items-center gap-2">
          <span class="me-1 d-none d-md-inline" [class.text-dark]="temaClaro"
            [class.text-white]="!temaClaro">{{usuarioLogado.nome}}</span>
          <button class="btn-sair" (click)="sair()" aria-label="Sair da conta">
            <i class="bi bi-box-arrow-right" [style.color]="corBotaoSair" aria-hidden="true"></i>
          </button>
        </div>
      </ng-template>
    </div>
  </nav>

  <div class="sidebar-overlay" [class.show]="sidebarAberta" (click)="fecharSidebar()" aria-hidden="true"></div>

  <aside class="sidebar d-flex flex-column" [class.mobile-open]="sidebarAberta" id="sidebar-menu">
    <div class="menu-principal">
      <button *ngIf="usuarioLogado" (click)="mudarAba('cadastrar')" [class.active]="aba==='cadastrar'">
        <i class="bi bi-plus-circle me-2" aria-hidden="true"></i> {{ modoEdicao ? 'Editando' : 'Nova Tarefa' }}
      </button>

      <button (click)="mudarAba('todas')" [class.active]="aba==='todas'">
        <i class="bi bi-list-task me-2" aria-hidden="true"></i> Tarefas
      </button>

      <div class="sub-menu" *ngIf="aba==='todas' || aba==='concluidas' || aba==='abertas'">
        <button (click)="mudarAba('concluidas')" [class.active]="aba==='concluidas'">
          <i class="bi bi-check2-circle me-2" aria-hidden="true"></i> Conclu√≠das
        </button>
        <button (click)="mudarAba('abertas')" [class.active]="aba==='abertas'">
          <i class="bi bi-circle me-2" aria-hidden="true"></i> Abertas
        </button>
      </div>

      <button *ngIf="usuarioLogado" (click)="mudarAba('categorias')" [class.active]="aba==='categorias'">
        <i class="bi bi-tag me-2" aria-hidden="true"></i> Categorias
      </button>
    </div>

    <div class="sidebar-footer mt-auto">

      <button (click)="mudarAba('ajuda')" [class.active]="aba==='ajuda'">
        <i class="bi bi-question-circle me-2" aria-hidden="true"></i> Ajuda
      </button>

      <button (click)="mudarAba('config')" [class.active]="aba==='config'" style="margin-bottom: 15px;">
        <i class="bi bi-gear me-2" aria-hidden="true"></i> Configura√ß√µes
      </button>

      <ng-container *ngIf="!usuarioLogado">
        <div class="small text-muted p-2">Fa√ßa login para salvar</div>
      </ng-container>

      <div class="info-app">
        <p class="text-muted small">
          &copy; 2025 Projeto ToDo. <br>
          Desenvolvido por Krieger.
        </p>
      </div>
    </div>
  </aside>

  <main class="conteudo">

    <section *ngIf="aba==='login'" class="centro" aria-label="Se√ß√£o de Login">
      <form class="card-tarefas" (ngSubmit)="login()">
        <h4 class="text-center mb-3">Login</h4>

        <div *ngIf="contaExcluidaSucesso && aba === 'login'"
          class="alert alert-success text-center mb-3 animate__animated animate__fadeIn" role="alert">
          <i class="bi bi-check-circle-fill me-2" aria-hidden="true"></i>
          <strong>Conta exclu√≠da com sucesso!</strong><br>
          Todos os seus dados foram removidos do nosso sistema.
        </div>

        <label for="loginEmailInput" class="visually-hidden">Email</label>
        <input id="loginEmailInput" class="form-control mb-1" placeholder="Email" [(ngModel)]="loginEmail" name="e"
          type="email" required autocomplete="email">
        <div *ngIf="erroLoginEmail" class="text-danger small" role="alert">Email incorreto ou n√£o encontrado</div>

        <div class="password-input-container mb-3">
          <label for="loginSenhaInput" class="visually-hidden">Senha</label>
          <input id="loginSenhaInput" [type]="mostrarSenhaLogin ? 'text' : 'password'" [(ngModel)]="loginSenha"
            name="loginSenha" placeholder="Senha" class="form-control" autocomplete="current-password">

          <button class="toggle-password" type="button" (click)="alternarVisibilidadeSenha('login')"
            [attr.aria-label]="mostrarSenhaLogin ? 'Ocultar Senha' : 'Mostrar Senha'"
            [attr.aria-expanded]="mostrarSenhaLogin" title="Mostrar/Ocultar Senha">
            <i *ngIf="!mostrarSenhaLogin" class="bi bi-eye-slash" aria-hidden="true"></i>
            <i *ngIf="mostrarSenhaLogin" class="bi bi-eye" aria-hidden="true"></i>
          </button>
        </div>
        <div *ngIf="erroLoginSenha" class="text-danger small" role="alert">Senha incorreta</div>

        <button type="submit" [disabled]="isLoading" class="btn btn-primary w-100 mt-3">
          {{ isLoading ? 'Entrando...' : 'Entrar' }}
        </button>
      </form>
    </section>

    <section *ngIf="aba==='cadastro'" class="centro" aria-label="Se√ß√£o de Cadastro de Usu√°rio">
      <form class="card-tarefas" (ngSubmit)="salvarUsuario()" #formUser="ngForm">
        <h4 class="text-center mb-3">Cadastro</h4>

        <div class="mb-2">
          <label for="cadastroNomeInput" class="visually-hidden">Nome</label>
          <input id="cadastroNomeInput" class="form-control" placeholder="Nome" [(ngModel)]="usuario.nome" name="n"
            required autocomplete="given-name">
          <div *ngIf="erroNome" class="text-danger small d-block" role="alert">Nome obrigat√≥rio</div>
        </div>

        <div class="mb-2">
          <label for="cadastroSobrenomeInput" class="visually-hidden">Sobrenome</label>
          <input id="cadastroSobrenomeInput" class="form-control" placeholder="Sobrenome"
            [(ngModel)]="usuario.sobrenome" name="sn" required autocomplete="family-name">
          <div *ngIf="erroSobrenome" class="text-danger small d-block" role="alert">Sobrenome obrigat√≥rio</div>
        </div>

        <div class="mb-2">
          <label for="cadastroIdadeInput" class="visually-hidden">Idade</label>
          <input id="cadastroIdadeInput" class="form-control" type="number" placeholder="Idade"
            [(ngModel)]="usuario.idade" name="i" required>
          <div *ngIf="erroIdade" class="text-danger small d-block" role="alert">Idade inv√°lida</div>
        </div>

        <div class="mb-2">
          <label for="cadastroEmailInput" class="visually-hidden">Email</label>
          <input id="cadastroEmailInput" class="form-control" type="email" placeholder="Email"
            [(ngModel)]="usuario.email" name="email" required autocomplete="email">
          <div *ngIf="erroEmail" class="text-danger small d-block" role="alert">Email inv√°lido</div>
          <div *ngIf="erroEmailExistente" class="alert alert-warning mt-1 p-1 small" role="alert">Email j√° cadastrado
          </div>
        </div>

        <div class="mb-3">
          <div class="password-input-container mb-3">
            <label for="cadastroSenhaInput" class="visually-hidden">Senha (min 6)</label>
            <input id="cadastroSenhaInput" class="form-control" [type]="mostrarSenhaCadastro ? 'text' : 'password'"
              placeholder="Senha (min 6)" [(ngModel)]="usuario.senha" name="senha" required autocomplete="new-password">
            <button class="toggle-password" type="button" (click)="alternarVisibilidadeSenha('cadastro')"
              [attr.aria-label]="mostrarSenhaCadastro ? 'Ocultar Senha' : 'Mostrar Senha'"
              [attr.aria-expanded]="mostrarSenhaCadastro" title="Mostrar/Ocultar Senha">
              <i *ngIf="!mostrarSenhaCadastro" class="bi bi-eye-slash" aria-hidden="true"></i>
              <i *ngIf="mostrarSenhaCadastro" class="bi bi-eye" aria-hidden="true"></i>
            </button>
          </div>
          <div *ngIf="erroCadastroSenha" class="text-danger small d-block" role="alert">Senha inv√°lida (m√≠nimo 6
            caracteres)</div>
        </div>

        <button type="submit" [disabled]="isLoading" class="btn btn-primary w-100">
          <span *ngIf="isLoading" class="spinner-pequeno" aria-hidden="true"></span>
          {{ isLoading ? 'Cadastrando...' : 'Cadastrar' }}
        </button>
      </form>
    </section>

    <section *ngIf="aba==='config'" class="centro" aria-label="Se√ß√£o de Configura√ß√µes">

      <div class="card-tarefas mb-4 w-100">

        <h2 class="mb-4">Configura√ß√µes</h2>

        <small *ngIf="msgSucessoPerfil" class="text-success d-block mb-3" role="status">{{ msgSucessoPerfil }}</small>
        <small *ngIf="msgErroPerfil" class="text-danger d-block mb-3" role="alert">{{ msgErroPerfil }}</small>
        <small *ngIf="msgErroReautenticacao" class="text-danger d-block mb-3" role="alert">{{ msgErroReautenticacao
          }}</small>

        <button class="btn btn-primary w-100 mb-2" type="button" (click)="toggleEdicaoPerfil()"
          [attr.aria-expanded]="mostrarEdicaoPerfil" aria-controls="collapsePerfil">
          Gerenciamento do Perfil
        </button>

        <div [ngClass]="{'collapse': !mostrarEdicaoPerfil, 'show': mostrarEdicaoPerfil}" id="collapsePerfil">
          <hr class="mt-2 mb-3">

          <form (ngSubmit)="salvarAlteracoesPerfil()">
            <div class="form-group mb-3 text-start">
              <label for="perfilNome" class="form-label">Nome:</label>
              <input id="perfilNome" class="form-control" [(ngModel)]="perfil.nome" name="perfilNome" required
                autocomplete="given-name">

              <small *ngIf="erroNomeObrigatorio" class="text-danger" role="alert">
                O campo Nome n√£o pode ficar em branco.
              </small>

            </div>

            <div class="form-group mb-3 text-start">
              <label for="perfilSobrenome" class="form-label">Sobrenome:</label>
              <input id="perfilSobrenome" class="form-control" [(ngModel)]="perfil.sobrenome" name="perfilSobrenome"
                autocomplete="family-name">

              <small *ngIf="erroSobrenomeObrigatorio" class="text-danger" role="alert">
                O campo Sobrenome n√£o pode ficar em branco.
              </small>

            </div>

            <button type="submit" class="btn btn-primary w-100 mb-1">Salvar Perfil</button>

            <hr class="mt-3 mb-3">

          </form>

        </div>

        <button class="btn btn-secondary w-100 mb-2" type="button" (click)="toggleAlteracaoLogin()"
          [attr.aria-expanded]="mostrarAlteracaoLogin" aria-controls="collapseLogin">
          Alterar Login (E-mail e Senha)
        </button>

        <div [ngClass]="{'collapse': !mostrarAlteracaoLogin, 'show': mostrarAlteracaoLogin}" id="collapseLogin">
          <hr class="mt-2 mb-3">

          <form (ngSubmit)="alterarLogin()">
            <small *ngIf="msgSucessoLogin" class="text-success d-block mb-3" role="status">{{ msgSucessoLogin
              }}</small>

            <div class="form-group mb-3 text-start">
              <label for="novoEmail" class="form-label">Novo E-mail:</label>
              <input id="novoEmail" class="form-control" [(ngModel)]="novoEmail" name="novoEmail" type="email"
                placeholder="{{ perfil.email }}" autocomplete="email">

              <small *ngIf="erroLoginEmailInvalido" class="text-danger" role="alert">
                O novo e-mail deve ser v√°lido (conter @).
              </small>
            </div>

            <hr>

            <div class="form-group mb-3 text-start">
              <label for="novaSenha" class="form-label">Nova Senha:</label>
              <div class="password-input-container mb-3">
                <input id="novaSenha" class="form-control" [(ngModel)]="novaSenha" name="novaSenha"
                  [type]="mostrarSenhaAlterar ? 'text' : 'password'" placeholder="M√≠nimo 6 caracteres"
                  autocomplete="new-password">
                <button class="toggle-password" type="button" (click)="alternarVisibilidadeSenha('alterar')"
                  [attr.aria-label]="mostrarSenhaAlterar ? 'Ocultar Senha' : 'Mostrar Senha'"
                  [attr.aria-expanded]="mostrarSenhaAlterar" title="Mostrar/Ocultar Senha">
                  <i *ngIf="!mostrarSenhaAlterar" class="bi bi-eye-slash" aria-hidden="true"></i>
                  <i *ngIf="mostrarSenhaAlterar" class="bi bi-eye" aria-hidden="true"></i>
                </button>
              </div>

              <small *ngIf="erroLoginSenhaPequena" class="text-danger" role="alert">
                A senha deve ter no m√≠nimo 6 caracteres.
              </small>
              <small *ngIf="erroLoginSenhaIgualAtual" class="text-danger" role="alert">
                A nova senha n√£o pode ser igual √† senha atual.
              </small>
            </div>

            <div class="form-group mb-3 text-start">
              <label for="confirmaNovaSenha" class="form-label">Confirme a Nova Senha:</label>
              <div class="password-input-container mb-3">
                <input id="confirmaNovaSenha" class="form-control" [(ngModel)]="confirmaNovaSenha"
                  name="confirmaNovaSenha" [type]="mostrarSenhaConfirmarAlterar ? 'text' : 'password'"
                  placeholder="As senhas devem ser id√™nticas" autocomplete="new-password">
                <button class="toggle-password" type="button" (click)="alternarVisibilidadeSenha('confirmarAlterar')"
                  [attr.aria-label]="mostrarSenhaConfirmarAlterar ? 'Ocultar Senha' : 'Mostrar Senha'"
                  [attr.aria-expanded]="mostrarSenhaConfirmarAlterar" title="Mostrar/Ocultar Senha">
                  <i *ngIf="!mostrarSenhaConfirmarAlterar" class="bi bi-eye-slash" aria-hidden="true"></i>
                  <i *ngIf="mostrarSenhaConfirmarAlterar" class="bi bi-eye" aria-hidden="true"></i>
                </button>
              </div>

              <small *ngIf="erroLoginSenhasDiferentes" class="text-danger" role="alert">
                As senhas n√£o conferem.
              </small>
            </div>

            <hr class="mt-3 mb-3">

            <div class="form-group mb-3 text-start">
              <label for="senhaAtual" class="form-label">Confirme sua <strong>Senha Atual</strong>:</label>
              <div class="password-input-container mb-3">
                <input id="senhaAtual" class="form-control" [(ngModel)]="perfil.senhaAtual" name="senhaAtual"
                  [type]="mostrarSenhaConfirmacao ? 'text' : 'password'" required placeholder="Senha atual"
                  autocomplete="current-password">
                <button class="toggle-password" type="button" (click)="alternarVisibilidadeSenha('confirmacao')"
                  [attr.aria-label]="mostrarSenhaConfirmacao ? 'Ocultar Senha' : 'Mostrar Senha'"
                  [attr.aria-expanded]="mostrarSenhaConfirmacao" title="Mostrar/Ocultar Senha">
                  <i *ngIf="!mostrarSenhaConfirmacao" class="bi bi-eye-slash" aria-hidden="true"></i>
                  <i *ngIf="mostrarSenhaConfirmacao" class="bi bi-eye" aria-hidden="true"></i>
                </button>
              </div>

              <small *ngIf="erroLoginSenhaAtualIncorreta" class="text-danger" role="alert">
                {{ msgErroReautenticacao }}
              </small>
            </div>

            <button type="submit" class="btn btn-warning w-100">Atualizar Login</button>
          </form>

        </div>

        <hr class="mt-3 mb-3">

        <button class="btn btn-secondary w-100 mb-2" (click)="abrirModalLimpeza()" aria-haspopup="dialog">Limpar Tarefas
          Conclu√≠das</button>

        <div class="modal-backdrop" *ngIf="mostrarModalLimpeza" aria-hidden="true"></div>
        <div class="modal-custom" *ngIf="mostrarModalLimpeza" role="dialog" aria-modal="true"
          aria-labelledby="limpezaTitulo">
          <div class="modal-content-custom">

            <ng-container *ngIf="alertaLimpezaVazia">
              <h3 id="limpezaTitulo">‚ö†Ô∏è Aten√ß√£o</h3>
              <p>N√£o encontramos nenhuma tarefa conclu√≠da para apagar!</p>
              <p class="text-muted small">Conclua algumas tarefas e tente novamente.</p>

              <button class="btn btn-secondary mt-3" (click)="fecharModalLimpeza()">
                Entendi
              </button>
            </ng-container>

            <ng-container *ngIf="!alertaLimpezaVazia && limpezaContador === 0">
              <h3 id="limpezaTitulo">Confirma√ß√£o de Limpeza</h3>
              <p>Tem certeza que deseja apagar <strong>TODAS</strong> as tarefas conclu√≠das?</p>
              <p class="text-danger">Esta a√ß√£o √© irrevers√≠vel e os dados ser√£o removidos permanentemente.</p>

              <button class="btn btn-danger me-2" (click)="executarLimpeza()">
                Sim, Apagar Agora
              </button>
              <button class="btn btn-secondary" (click)="fecharModalLimpeza()">
                Cancelar
              </button>
            </ng-container>

            <ng-container *ngIf="limpezaContador > 0">
              <h3 id="limpezaTitulo">‚úÖ Limpeza Conclu√≠da!</h3>
              <p>{{ limpezaContador }} tarefa(s) conclu√≠da(s) foram apagadas com sucesso.</p>

              <h5 class="mt-3">Tarefas Removidas:</h5>
              <div class="lista-excluidas">
                <ul class="list-unstyled" aria-label="Lista de tarefas exclu√≠das">
                  <li *ngFor="let tarefa of tarefasExcluidas">
                    <small>üóëÔ∏è {{ tarefa.nome }}</small>
                  </li>
                </ul>
              </div>

              <button class="btn btn-primary mt-3" (click)="fecharModalLimpeza()">
                Fechar
              </button>
            </ng-container>

          </div>
        </div>

        <button class="btn btn-secondary w-100 mb-2" (click)="alternarTema()">Tema: {{temaClaro ? 'Claro' :
          'Escuro'}}</button>

        <hr class="mt-3 mb-3">

        <button class="btn btn-secondary w-100 mb-2" (click)="sair()">Sair</button>

        <button class="btn btn-danger w-100" (click)="abrirModalExcluir()" aria-haspopup="dialog">Excluir Minha
          Conta</button>

        <div class="modal-backdrop" *ngIf="mostrarModalExcluirConta" aria-hidden="true"></div>
        <div class="modal-custom" *ngIf="mostrarModalExcluirConta" role="dialog" aria-modal="true"
          aria-labelledby="exclusaoTitulo">
          <div class="modal-content-custom border border-danger">

            <ng-container *ngIf="!contaExcluidaSucesso">
              <h3 id="exclusaoTitulo" class="text-danger">Excluir Conta</h3>
              <p>Esta a√ß√£o √© <b>permanente</b>. Todos os seus dados e tarefas ser√£o apagados para sempre.</p>

              <div class="mb-3 text-start">
                <label for="senhaExcluirInput" class="form-label">Confirme sua senha para prosseguir:</label>
                <input id="senhaExcluirInput" type="password" class="form-control" [(ngModel)]="senhaParaExcluir"
                  autocomplete="current-password">
                <small class="text-danger" *ngIf="erroExcluirConta" role="alert">{{ erroExcluirConta }}</small>
              </div>

              <div class="d-flex justify-content-center">
                <button class="btn btn-danger me-2" (click)="confirmarExclusaoConta()" [disabled]="deletandoConta">
                  {{ deletandoConta ? 'Excluindo...' : 'Excluir Conta' }}
                </button>
                <button class="btn btn-secondary" (click)="mostrarModalExcluirConta = false">
                  Cancelar
                </button>
              </div>
            </ng-container>

            <ng-container *ngIf="contaExcluidaSucesso">
              <h3 id="exclusaoTitulo" class="text-success">Conta Exclu√≠da</h3>
              <p>Sua conta e todos os seus dados foram removidos com sucesso do nosso sistema.</p>
              <p>Esperamos ver voc√™ de volta em breve!</p>

              <button class="btn btn-primary mt-2" (click)="irParaLogin()">
                Voltar para o Login
              </button>
            </ng-container>

          </div>
        </div>
      </div>
    </section>

    <section *ngIf="aba==='ajuda'" class="centro" aria-label="Se√ß√£o de Ajuda e FAQ">
      <div class="card-tarefas w-100 p-0" style="max-width: 900px;">

        <h4 class="text-center p-3 m-0" [class.border-bottom]="!temaClaro" [class.border-bottom-light]="temaClaro">
          Guia de Uso
        </h4>

        <div class="tutorial-list">
          <div *ngFor="let topico of duvidas" class="tutorial-item">

            <button
              class="btn-tutorial-link w-100 text-start py-3 px-4 d-flex justify-content-between align-items-center"
              [class.active]="topico.id === topicoAjudaAtivo" (click)="mudarTopicoAjuda(topico.id)"
              [attr.aria-expanded]="topico.id === topicoAjudaAtivo"
              [attr.aria-controls]="'tutorial-content-' + topico.id">
              <span class="fw-bold"><i class="bi bi-question-circle me-2" aria-hidden="true"></i>
                {{topico.pergunta}}</span>
              <i class="bi" [ngClass]="{
                  'bi-chevron-down': topico.id !== topicoAjudaAtivo,
                  'bi-chevron-up': topico.id === topicoAjudaAtivo
                }" aria-hidden="true">
              </i>
            </button>

            <div class="tutorial-content px-4 pb-3 collapse" [class.open]="topico.id === topicoAjudaAtivo"
              [class.show]="topico.id === topicoAjudaAtivo" [id]="'tutorial-content-' + topico.id"
              [innerHTML]="topico.conteudo">
            </div>

          </div>
        </div>

      </div>
    </section>

    <section *ngIf="aba==='cadastrar'" class="centro" aria-label="Formul√°rio de Tarefa">
      <form (ngSubmit)="modoEdicao ? solicitarConfirmacaoEdicao(form) : adicionarTarefa(form)" #form="ngForm"
        class="card-tarefas">
        <h4 class="text-center mb-3">{{ modoEdicao ? 'Editar Tarefa' : 'Nova Tarefa' }}</h4>

        <label for="tituloInput">T√≠tulo *</label>
        <input id="tituloInput" class="form-control mb-1" minlength="3" name="titulo" [(ngModel)]="novaTarefa.titulo"
          required #tituloInput="ngModel">
        <div *ngIf="tituloInput.invalid && (tituloInput.dirty || tituloInput.touched || form.submitted)"
          class="text-danger small" role="alert">
          <span *ngIf="tituloInput.errors?.['required']">T√≠tulo obrigat√≥rio.</span>
          <span *ngIf="tituloInput.errors?.['minlength']">M√≠nimo 3 caracteres.</span>
        </div>

        <label for="descricaoTextarea">Descri√ß√£o</label>
        <textarea id="descricaoTextarea" class="form-control mb-2" name="descricao" [(ngModel)]="novaTarefa.descricao"
          rows="3"></textarea>

        <label for="dataInput">Data *</label>
        <input id="dataInput" type="date" [attr.min]="hoje" class="form-control mb-2" name="data"
          [(ngModel)]="novaTarefa.data" required #dataInput="ngModel">
        <div *ngIf="dataInput.invalid && form.submitted" class="text-danger small" role="alert">Data obrigat√≥ria</div>

        <div class="row">
          <div class="col-md-6">
            <label for="prioridadeSelect">Prioridade</label>
            <select id="prioridadeSelect" class="form-select mb-2" name="prioridade"
              [(ngModel)]="novaTarefa.prioridade">
              <option value="baixa">Baixa</option>
              <option value="media">M√©dia</option>
              <option value="alta">Alta</option>
            </select>
          </div>

          <div class="col-md-6">
            <label for="categoriaSelect">Categoria</label>
            <select id="categoriaSelect" class="form-select mb-2" name="categoria" [(ngModel)]="novaTarefa.categoria">
              <option value="">Sem categoria</option>
              <option *ngFor="let cat of categorias" [value]="cat.nome">{{cat.nome}}</option>
            </select>
          </div>
        </div>

        <button type="submit" class="btn btn-primary w-100 mt-2">
          {{modoEdicao ? "Salvar Altera√ß√µes" : "Salvar"}}
        </button>

        <button *ngIf="modoEdicao" type="button" class="btn btn-secondary w-100 mt-2" (click)="cancelarEdicao()">
          Cancelar Edi√ß√£o
        </button>

        <div *ngIf="alertTarefaSalva" class="alert alert-success mt-2 p-2 text-center" role="status">
          Tarefa salva!
        </div>
      </form>
    </section>

    <section *ngIf="aba==='categorias'" class="centro" aria-label="Gerenciamento de Categorias">
      <div class="card-tarefas">
        <h4 class="text-center mb-3">Gerenciar Categorias</h4>

        <div class="mb-3">
          <h5 class="mb-3 text-center">
            {{ modoEdicaoCategoria ? 'Editar Categoria' : 'Nova Categoria' }}
          </h5>

          <label for="nomeCatInput">Nome da Categoria</label>
          <input id="nomeCatInput" class="form-control mb-2" placeholder="Ex: Trabalho..."
            [(ngModel)]="novaCategoria.nome" name="nomeCat">
          <div *ngIf="erroNomeCategoria" class="text-danger small" role="alert">Digite um nome</div>

          <label for="corCatInput">Cor da Etiqueta</label>
          <input id="corCatInput" type="color" class="form-control form-control-color mb-2 w-100"
            [(ngModel)]="novaCategoria.cor" name="corCat" title="Escolha uma cor">

          <button class="btn btn-primary w-100 mt-2" (click)="adicionarCategoria()">
            {{ modoEdicaoCategoria ? 'Salvar Altera√ß√µes' : 'Adicionar' }}
          </button>

          <button *ngIf="modoEdicaoCategoria" class="btn btn-secondary w-100 mt-2" (click)="cancelarEdicaoCategoria()">
            Cancelar Edi√ß√£o
          </button>
        </div>

        <hr>

        <h5 class="text-center mb-3">Categorias Atuais</h5>
        <div *ngIf="categorias.length === 0" class="text-center text-muted py-3">
          Nenhuma categoria
        </div>

        <div class="categoria-lista" style="max-height: 300px; overflow-y: auto;">
          <div *ngFor="let categoria of categorias"
            class="categoria-item mb-2 p-2 rounded d-flex justify-content-between align-items-center"
            [style.borderLeft]="'4px solid ' + categoria.cor">
            <div class="d-flex align-items-center gap-2">
              <div class="categoria-cor" [style.backgroundColor]="categoria.cor" aria-hidden="true"></div>
              <span class="fw-bold">{{categoria.nome}}</span>
            </div>

            <div class="d-flex gap-2">
              <button class="btn btn-outline-primary btn-sm border-0" (click)="ativarEdicaoCategoria(categoria)"
                [disabled]="modoEdicaoCategoria" aria-label="Editar categoria {{categoria.nome}}">
                <i class="bi bi-pencil" aria-hidden="true"></i>
              </button>
              <button class="btn btn-outline-danger btn-sm border-0" (click)="excluirCategoria(categoria)"
                [disabled]="modoEdicaoCategoria" aria-label="Excluir categoria {{categoria.nome}}">
                <i class="bi bi-trash" aria-hidden="true"></i>
              </button>
            </div>
          </div>
        </div>

        <div *ngIf="categoriaSendoUsada" class="alert alert-warning mt-3 small" role="alert">
          <i class="bi bi-exclamation-triangle me-1" aria-hidden="true"></i> {{erroExclusaoCategoria}}
        </div>

      </div>
    </section>

    <section
      *ngIf="aba!=='login' && aba!=='cadastro' && aba!=='config' && aba!=='cadastrar' && aba!=='categorias' && aba!=='ajuda'"
      class="listagem-container" aria-label="Lista de Tarefas">

      <div class="card p-3 mb-4" [class.bg-dark]="!temaClaro" [class.border-0]="!temaClaro">

        <h5 class="mb-3"><i class="bi bi-funnel me-2" aria-hidden="true"></i> Filtros e Pesquisa</h5>

        <div class="mb-3 search-box">
          <label for="termoPesquisaInput" class="form-label fw-bold small mb-1">Pesquisar T√≠tulo/Descri√ß√£o</label>
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-search" aria-hidden="true"></i></span>
            <input id="termoPesquisaInput" type="text" class="form-control" placeholder="Digite para buscar..."
              [(ngModel)]="termoPesquisa" (ngModelChange)="tarefasFiltradas()" name="search">
            <button *ngIf="termoPesquisa" class="btn btn-outline-secondary" type="button"
              (click)="termoPesquisa = ''; tarefasFiltradas()" aria-label="Limpar Pesquisa">
              <i class="bi bi-x" aria-hidden="true"></i>
            </button>
          </div>
        </div>

        <div class="row mb-3 gx-2">

          <div class="col-12 col-md-4 mb-2 mb-md-0">
            <label for="filtroDataInput" class="form-label fw-bold small mb-1">Data de Vencimento</label>
            <input id="filtroDataInput" type="date" class="form-control" [(ngModel)]="filtroData"
              (ngModelChange)="tarefasFiltradas()" name="filtroData" title="Filtrar por data de vencimento">
          </div>

          <div class="col-6 col-md-4 mb-2 mb-md-0">
            <label for="filtroPrioridadeSelect" class="form-label fw-bold small mb-1">Prioridade</label>
            <select id="filtroPrioridadeSelect" class="form-select" [(ngModel)]="filtroPrioridade"
              (ngModelChange)="tarefasFiltradas()" name="filtroPrioridade">
              <option value="">Todas as Prioridades</option>
              <option value="baixa">Baixa</option>
              <option value="media">M√©dia</option>
              <option value="alta">Alta</option>
            </select>
          </div>

          <div class="col-6 col-md-4">
            <label for="filtroCategoriaSelect" class="form-label fw-bold small mb-1">Categoria</label>
            <select id="filtroCategoriaSelect" class="form-select" [(ngModel)]="filtroCategoria"
              (ngModelChange)="tarefasFiltradas()" name="filtroCategoria">
              <option value="">Todas as Categorias</option>
              <option *ngFor="let cat of categorias" [value]="cat.nome">{{cat.nome}}</option>
            </select>
          </div>
        </div>

        <div class="d-flex justify-content-end mt-2">
          <button class="btn btn-sm btn-outline-secondary d-flex align-items-center" (click)="limparTodosFiltros()"
            aria-label="Limpar todos os filtros de busca">
            <i class="bi bi-x-circle me-1" aria-hidden="true"></i> Limpar Filtros
          </button>
        </div>

      </div>

      <table class="table table-hover tabela-responsiva" [class.table-dark]="!temaClaro"
        aria-label="Tarefas Cadastradas">
        <thead>
          <tr>
            <th scope="col">T√≠tulo</th>
            <th scope="col">Descri√ß√£o</th>
            <th scope="col">Prioridade</th>
            <th scope="col">Categoria</th>
            <th scope="col">Data</th>
            <th scope="col">Status</th>
            <th scope="col" class="text-end">A√ß√µes</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let tarefa of tarefasFiltradas(); let i=index">
            <td data-label="T√≠tulo" [class.ok]="tarefa.concluida" class="fw-bold-mobile">{{tarefa.titulo |
              titlecase}}</td>

            <td data-label="Descri√ß√£o" [class.ok]="tarefa.concluida" class="text-wrap-mobile">
              {{tarefa.descricao || '-'}}
            </td>

            <td data-label="Prioridade">
              <span class="badge" [ngClass]="{
                'bg-success': tarefa.prioridade === 'baixa',
                'bg-warning': tarefa.prioridade === 'media',
                'bg-danger': tarefa.prioridade === 'alta'
                }" [attr.aria-label]="'Prioridade: ' + (tarefa.prioridade | titlecase)">
                {{tarefa.prioridade | titlecase}}
              </span>
            </td>

            <td data-label="Categoria">
              <span *ngIf="tarefa.categoria" class="badge" [style.backgroundColor]="obterCorCategoria(tarefa.categoria)"
                [style.color]="obtendoCorTextoConstraste(obterCorCategoria(tarefa.categoria))">
                {{tarefa.categoria}}
              </span>
              <span *ngIf="!tarefa.categoria" class="text-muted small">-</span>
            </td>

            <td data-label="Data">{{tarefa.data | date:'dd/MM/yyyy' : '+0000'}}</td>

            <td data-label="Status">
              <div class="form-check form-switch p-0 m-0 d-flex align-items-center gap-2">
                <input class="form-check-input m-0" type="checkbox" [checked]="tarefa.concluida"
                  (change)="alternarStatus(tarefa)"
                  [attr.aria-label]="'Marcar como ' + (tarefa.concluida ? 'pendente' : 'conclu√≠da') + ': ' + tarefa.titulo">
                <span>{{ tarefa.concluida ? 'Conclu√≠da' : 'Pendente' }}</span>
              </div>
            </td>

            <td data-label="A√ß√µes">
              <div class="d-flex gap-2 justify-content-end w-100 mobile-actions">
                <button class="btn btn-warning btn-sm" (click)="editarTarefa(tarefa)"
                  aria-label="Editar tarefa {{tarefa.titulo}}">
                  <i class="bi bi-pencil" aria-hidden="true"></i>
                </button>

                <button class="btn btn-sm btn-danger" (click)="confirmarExclusao(tarefa)"
                  aria-label="Excluir tarefa {{tarefa.titulo}}">
                  <i class="bi bi-trash" aria-hidden="true"></i>
                </button>
              </div>
            </td>
          </tr>

          <tr *ngIf="tarefasFiltradas().length===0">
            <td colspan="7" class="text-center py-5 text-muted">
              <i class="bi bi-inbox fs-1 d-block mb-2 opacity-50" aria-hidden="true"></i>
              Nenhuma tarefa encontrada nesta visualiza√ß√£o.
            </td>
          </tr>
        </tbody>
      </table>
    </section>

    <div *ngIf="tarefaConfirmacaoEdicao" class="modal-backdrop" aria-hidden="true"></div>
    <div *ngIf="tarefaConfirmacaoEdicao" class="modal-card" role="dialog" aria-modal="true"
      aria-labelledby="edicaoModalTitle">
      <p id="edicaoModalTitle">Confirmar altera√ß√µes na tarefa <b>{{tarefaConfirmacaoEdicao.titulo}}</b>?</p>
      <div class="d-flex gap-2">
        <button class="btn btn-primary w-50" (click)="confirmarEdicao()">Confirmar</button>
        <button class="btn btn-secondary w-50" (click)="cancelarConfirmacaoEdicao()">Cancelar</button>
      </div>
    </div>

    <div *ngIf="tarefaSelecionadaParaExcluir" class="modal-backdrop" aria-hidden="true"></div>
    <div *ngIf="tarefaSelecionadaParaExcluir" class="modal-card" role="dialog" aria-modal="true"
      aria-labelledby="exclusaoTarefaModalTitle">
      <p id="exclusaoTarefaModalTitle">Excluir <b>{{tarefaSelecionadaParaExcluir.titulo}}</b>?</p>
      <div class="d-flex gap-2">
        <button class="btn btn-danger w-50" (click)="excluirDefinitivo()">Excluir</button>
        <button class="btn btn-secondary w-50" (click)="cancelarExclusao()">Cancelar</button>
      </div>
    </div>

    <div *ngIf="categoriaSelecionadaParaExcluir" class="modal-backdrop" aria-hidden="true"></div>
    <div *ngIf="categoriaSelecionadaParaExcluir" class="modal-card" role="dialog" aria-modal="true"
      aria-labelledby="exclusaoCategoriaModalTitle">
      <p id="exclusaoCategoriaModalTitle">Excluir categoria <b>{{categoriaSelecionadaParaExcluir.nome}}</b>?</p>
      <div class="d-flex gap-2">
        <button class="btn btn-danger w-50" (click)="confirmarExclusaoCategoria()">Excluir</button>
        <button class="btn btn-secondary w-50" (click)="cancelarExclusaoCategoria()">Cancelar</button>
      </div>
    </div>

  </main>
</div>